<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title th:text="${pageTitle} + ' - MyShop'">Sản phẩm</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body class="d-flex flex-column min-vh-100">
	<!-- Header -->
	<div th:replace="~{layout/_fragments :: main-header}"></div>

	<!-- Main content -->
	<main class="container my-5 flex-shrink-0">
		<h2 class="text-center mb-4" th:text="${pageTitle}"></h2>

		<!-- Nếu không có sản phẩm -->
		<div th:if="${products.isEmpty()}" class="text-center">
			<p>Chưa có sản phẩm nào trong danh mục này.</p>
		</div>

		<!-- Danh sách sản phẩm -->
		<div class="row g-4" th:if="!${products.isEmpty()}">
			<div class="col-md-3" th:each="product : ${products}">
				<div class="card h-100 shadow-sm">
					<img th:src="@{'/picture/' + ${product.image}}" class="card-img-top"
						style="height: 300px; object-fit: cover;">
					<div class="card-body d-flex flex-column">
						<h5 class="card-title" th:text="${product.name}"></h5>
						<p class="card-text fw-bold text-danger"
							th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + 'đ'"></p>

						<div class="mt-auto">
							<!-- ✅ Nút xem chi tiết -->
							<a th:href="@{/products/detail/{id}(id=${product.id})}"
								class="btn btn-outline-primary w-100 mb-2">
								<i class="fa fa-eye"></i> Xem chi tiết
							</a>


							<!-- Hiển thị nút Sửa/Xóa nếu là ADMIN -->
							<div th:if="${session.role == 'ADMIN'}" class="d-flex gap-2 mb-2">
								<a th:href="@{/admin/products/edit/{id}(id=${product.id})}" class="btn btn-warning">
									<i class="fa fa-edit"></i> Sửa
								</a>
								<a th:href="@{/products/delete/{id}(id=${product.id})}" class="btn btn-danger w-50"
									onclick="return confirm('Bạn có chắc muốn xóa sản phẩm này không?')">
									<i class="fa fa-trash"></i> Xóa
								</a>
							</div>

							<!-- ✅ Nút thêm vào giỏ (chung cho cả ADMIN và USER) -->
							<form th:action="@{/cart/add}" method="post">
								<input type="hidden" name="productId" th:value="${product.id}" />
								<div class="mb-2">
									<select name="size" class="form-select form-select-sm" required>
										<option value="">-- Chọn size --</option>
										<option value="S">Size S</option>
										<option value="M">Size M</option>
										<option value="L">Size L</option>
										<option value="XL">Size XL</option>
									</select>
								</div>
								<button type="submit" class="btn btn-dark w-100">
									<i class="fa fa-shopping-cart"></i> Thêm vào giỏ
								</button>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>

	<!-- Footer -->
	<div th:replace="~{layout/_fragments :: main-footer}"></div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>